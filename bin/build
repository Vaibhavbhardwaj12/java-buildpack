#!/usr/bin/env bash
# bin/compile <build-dir> <cache-dir> <env-dir>

echo ""
echo "[Java buildpack]"

# fail fast
set -eo pipefail

BP_DIR=$(cd $(dirname $0)/..; pwd) # absolute path

if [ ! -f "$BP_DIR/bin/maven-runner" ]; then
  echo "Bootstrapping buildpack binaries"
  bash "$BP_DIR/bin/bootstrap" "$BP_DIR"
  echo "Successfully compiled buildpack"
fi

export PATH="$PATH:$BP_DIR/bin"

maven-runner -platform $1 -cache $2 -launch $3 -buildpack "$BP_DIR" \
  -goals "clean dependency:list install" -options "-DskipTests"